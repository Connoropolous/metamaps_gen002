<% @metacodes = user_metacodes() %>

<%= form_for Topic.new, url: topics_url, remote: true do |form| %>
  <div class="openMetacodeSwitcher openLightbox" data-open="switchMetacodes">
    <div class="tooltipsAbove">Switch Metacodes</div>
  </div>

  <div class="pinCarousel">
    <div class="tooltipsAbove helpPin">Pin Open</div>
    <div class="tooltipsAbove helpUnpin">Unpin</div>
  </div>

  <div id="metacodeImg">
    <% @metacodes.each do |metacode| %>
      <img class="cloudcarousel" width="40" height="40" src="<%= asset_path metacode.icon %>" alt="<%= metacode.name %>" title="<%= metacode.name %>" data-id="<%= metacode.id %>" />
    <% end %>
  </div>

  <%= form.text_field :name, :maxlength => 140, :placeholder => "title..." %>

  <div id="metacodeImgTitle"></div>
  <div class="clearfloat"></div>

  <script>
    Metamaps.ServerData = Metamaps.ServerData || {}
    Metamaps.ServerData.selectedMetacodes = []
    Metamaps.ServerData.newSelectedMetacodes = []
    Metamaps.ServerData.selectedMetacodeNames = []
    Metamaps.ServerData.newSelectedMetacodeNames = []
    <% @metacodes.each do |metacode| %>
      Metamaps.ServerData.selectedMetacodes.push("<%= metacode.id %>");
      Metamaps.ServerData.newSelectedMetacodes.push("<%= metacode.id %>");
      Metamaps.ServerData.selectedMetacodeNames.push("<%= metacode.name %>");
      Metamaps.ServerData.newSelectedMetacodeNames.push("<%= metacode.name %>");
    <% end %> 
  </script>
<% end %>
